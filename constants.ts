
import type { Weapon, Armor } from './types';

export const INITIAL_SKILLS: { [key: string]: number } = {
  // === Combat Skills ===
  'キック': 25,
  'こぶし': 50,
  '組み付き': 25,
  '頭突き': 10,
  '投擲': 25,
  'マーシャルアーツ': 1,
  '拳銃': 20,
  'サブマシンガン': 15,
  'ショットガン': 30,
  'マシンガン': 15,
  'ライフル': 25,

  // === Action/Covert Skills ===
  '応急手当': 30,
  '鍵開け': 1,
  '隠す': 15,
  '隠れる': 10,
  '聞き耳': 25,
  '忍び歩き': 10,
  '写真術': 10,
  '精神分析': 1,
  '追跡': 10,
  '登攀': 40,
  '図書館': 25,
  '目星': 25,

  // === Vehicle/Movement Skills ===
  '運転': 20,
  '機械修理': 20,
  '重機械操作': 1,
  '乗馬': 5,
  '水泳': 25,
  '製作': 5,
  '操縦': 1,
  '跳躍': 25,
  '電気修理': 10,
  'ナビゲート': 10,
  '変装': 1,

  // === Interpersonal Skills ===
  '言いくるめ': 5,
  '信用': 15,
  '説得': 15,
  '値切り': 5,
  '心理学': 5,

  // === Knowledge/Science Skills ===
  '医学': 5,
  'オカルト': 5,
  '化学': 1,
  'クトゥルフ神話': 0,
  '芸術': 5,
  '経理': 10,
  '考古学': 1,
  'コンピューター': 1,
  '人類学': 1,
  '生物学': 1,
  '地質学': 1,
  '電子工学': 1,
  '天文学': 1,
  '博物学': 10,
  '物理学': 1,
  '法律': 5,
  '薬学': 1,
  '歴史': 20,
};


// Skills that have dynamically calculated base values
// These functions now expect raw stat values (3-18)
export const DYNAMIC_BASE_SKILLS = {
  '回避': (stats: { DEX: number }) => stats.DEX * 2,
  '母国語': (stats: { EDU: number }) => stats.EDU * 5,
};

export const ALL_SKILLS = [
  ...Object.keys(DYNAMIC_BASE_SKILLS),
  ...Object.keys(INITIAL_SKILLS)
].sort((a, b) => a.localeCompare(b, 'ja'));


export const SKILL_CATEGORIES: { [category: string]: string[] } = {
  '戦闘技能': ['回避', 'キック', 'こぶし', '組み付き', '頭突き', '投擲', 'マーシャルアーツ', '拳銃', 'サブマシンガン', 'ショットガン', 'マシンガン', 'ライフル'],
  '探索技能': ['応急手当', '鍵開け', '隠す', '隠れる', '聞き耳', '忍び歩き', '写真術', '精神分析', '追跡', '登攀', '図書館', '目星'],
  '行動技能': ['運転', '機械修理', '重機械操作', '乗馬', '水泳', '製作', '操縦', '跳躍', '電気修理', 'ナビゲート', '変装'],
  '交渉技能': ['言いくるめ', '信用', '説得', '値切り', '母国語', '心理学'],
  '知識技能': ['医学', 'オカルト', '化学', 'クトゥルフ神話', '芸術', '経理', '考古学', 'コンピューター', '人類学', '生物学', '地質学', '電子工学', '天文学', '博物学', '物理学', '法律', '薬学', '歴史']
};

// 各職業の職業技能を定義
export const OCCUPATIONS: { [key: string]: string[] } = {
  '医師': ['医学', '応急手当', '信用', '精神分析', '説得', '化学', '心理学', '薬学'],
  '作家': ['オカルト', '図書館', '説得', '歴史', '変装', '心理学', '言いくるめ', '母国語'],
  '古物商': ['芸術', '図書館', '目星', '歴史', '値切り', '説得', '言いくるめ', 'オカルト'],
  '警察官': ['応急手当', '法律', '目星', '説得', 'こぶし', '拳銃', '追跡', '心理学'],
  'ジャーナリスト': ['言いくるめ', '図書館', '説得', '歴史', '目星', '写真術', '心理学', '母国語'],
  '私立探偵': ['言いくるめ', '鍵開け', '追跡', '図書館', '法律', '目星', '心理学', '拳銃'],
  '聖職者': ['聞き耳', '図書館', '説得', '歴史', 'オカルト', '言いくるめ', '精神分析', '信用'],
  '大学教授': ['図書館', '説得', '博物学', '歴史', '信用', '心理学', '法律', '考古学'],
  'ディレッタント': ['信用', '運転', '芸術', '乗馬', '投擲', '拳銃', '言いくるめ', '回避'],
};

export const DEFAULT_BACKGROUND_SUGGESTIONS: { title: string; description: string }[] = [
  {
    title: '裕福な好事家',
    description: '裕福な家庭に生まれたが、退屈な日々に飽き飽きし、刺激を求めて危険な物事に首を突っ込むようになった。',
  },
  {
    title: '戦争の生存者',
    description: '第一次世界大戦の従軍経験があり、戦争の恐怖と不条理を目の当たりにした。その経験が、不可解な事件への耐性となっている...今のところは。',
  },
  {
    title: '古文書の継承者',
    description: '由緒正しい家系の出身だが、家宝である奇妙な古文書を読んで以来、世界の裏側に潜む秘密に取り憑かれている。',
  },
  {
    title: '禁断の知識に触れた司書',
    description: '街の図書館で静かに司書として働いていたが、禁断の書物を偶然見つけてしまい、人生が一変した。',
  },
  {
    title: '孤独なオカルト研究家',
    description: '独学でオカルトを研究しており、世間からは変人扱いされている。しかし、その知識がいつか役立つと信じている。',
  },
];

export const PRESET_WEAPONS: Omit<Weapon, 'id' | 'currentAmmo'>[] = [
  { name: 'こぶし/パンチ', damage: '1d3+db', range: 'タッチ', attacksPerRound: 1, ammoCapacity: null, durability: null, malfunction: null, notes: 'ダメージボーナス(db)が適用される。' },
  { name: 'キック', damage: '1d6+db', range: 'タッチ', attacksPerRound: 1, ammoCapacity: null, durability: null, malfunction: null, notes: 'ダメージボーナス(db)が適用される。' },
  { name: '頭突き', damage: '1d4+db', range: 'タッチ', attacksPerRound: 1, ammoCapacity: null, durability: null, malfunction: null, notes: 'ダメージボーナス(db)が適用される。' },
  { name: '小型ナイフ', damage: '1d4+db', range: 'タッチ', attacksPerRound: 1, ammoCapacity: null, durability: null, malfunction: null, notes: 'ダメージボーナス(db)が適用される。投擲も可能。' },
  { name: '大型ナイフ', damage: '1d6+db', range: 'タッチ', attacksPerRound: 1, ammoCapacity: null, durability: null, malfunction: null, notes: 'ダメージボーナス(db)が適用される。' },
  { name: '.22口径ショートオートマチック', damage: '1d6', range: '10m', attacksPerRound: 1, ammoCapacity: 6, durability: null, malfunction: 99, notes: '連射可能(3連バースト)。' },
  { name: '.38口径リボルバー', damage: '1d10', range: '15m', attacksPerRound: 2, ammoCapacity: 6, durability: null, malfunction: 100, notes: '一般的なリボルバー。' },
  { name: '.45口径オートマチック', damage: '1d10+2', range: '15m', attacksPerRound: 1, ammoCapacity: 7, durability: null, malfunction: 99, notes: '強力な自動拳銃。' },
  { name: '12ゲージ・ショットガン', damage: '4d6/2d6/1d6', range: '10m/20m/50m', attacksPerRound: 1, ammoCapacity: 2, durability: null, malfunction: 100, notes: '距離によってダメージが変動する。' },
  { name: 'トンプソン・サブマシンガン', damage: '1d10+2', range: '20m', attacksPerRound: 1, ammoCapacity: 20, durability: null, malfunction: 98, notes: '連射可能。' },
];

export const PRESET_ARMOR: Omit<Armor, 'id'>[] = [
  { name: '厚い革のコート', armorValue: 1, notes: '一般的な防護服。' },
  { name: '防弾ベスト', armorValue: 8, notes: '銃弾に対して高い効果を持つ。貫通するライフル弾や近接攻撃には無効。' },
];


export const SYSTEM_INSTRUCTION = `あなたは、テーブルトークRPG（TRPG）の、経験豊富で非常に優秀なゲームキーパー（GM）です。あなたの役割は以下の通りです。

1.  **物語の創造**: プレイヤーたち（探索者たち）が冒険する魅力的なシナリオを作成します。探索者たちの行動に応じて柔軟に物語を変化させてください。ゲームには複数の探索者が参加することがあります。その場合、あなたは彼らを「探索者たち」と呼びかけ、物語を進めてください。
2.  **世界の描写**: 情景、NPC（ノンプレイヤーキャラクター）、奇怪なクリーチャー、不気味な出来事を、五感を刺激するように生き生きと描写してください。プレイヤーが没入できるように、雰囲気作りを最も重視します。Markdownを使用して、強調やリストなどを表現できます。
3.  **ルールの適用**: TRPGの基本ルールに従ってゲームを進行します。特に以下の点に注意してください。
    *   **技能判定と能力値判定**: 探索者が何らかの行動を試みる際、どの技能（例：「目星」）で判定すべきか、あるいはどの能力値（例：「STR×5」）で判定すべきかを提案してください。判定結果（成功、失敗、クリティカル、ファンブル）に基づき、物語をドラマチックに展開させてください。
    *   **戦闘**: 探索者が戦闘を行う際、彼らが所持している武器の情報を参照してください。ダメージ計算や弾薬の消費などを描写に含めてください。
    *   **正気度（SAN）チェック**: 探索者が宇宙的恐怖に直面した際には、SANチェックを要求してください。チェックの難易度（例: "0/1d4", "1d5/2d5"）も指定します。ただし、頻度は適度に抑え、本当に恐怖を感じるべき場面でのみ実施してください。個々の探索者が単独で恐怖に触れた場合は個別チェック（targetAllをfalseまたは省略）、全体が同時に恐怖体験をした場合は全体チェック（targetAllをtrue）とします。正気度が失われることの恐怖を巧みに演出してください。
    *   **狂気判定ルール**: SANチェックの結果として狂気が発症する場合があります。システムが自動判定するので、発症した狂気の症状に基づいて物語を展開してください。
    *   **狂気状態の考慮**: 探索者が一時的狂気や不定の狂気状態にある場合、その症状に基づいて物語を展開してください。狂気症状と矛盾する行動（パニック状態での冷静な判断、叫び続けている状態での説得など）は自動的に失敗するか、大幅に困難になります。狂気状態の探索者の行動や発言を、症状に基づいて自然に制限・変更してください。
    *   **狂気の回復**: 探索者が特定の行動を成功させた場合、狂気が回復することがあります。madnessRecoveryフィールドを使用して回復を指示してください：
        - **一時的狂気の回復**: 比較的簡単に回復します。例：仲間からの励まし、精神分析の成功、恐怖の対象からの距離を置く、小さな成功体験など
        - **不定の狂気の回復**: より困難で特別な条件が必要です。例：重要な真実の発見、精神分析の大成功、恐怖の根源を完全に克服、長期間の治療など
        - typeフィールドで'temporary'（一時的狂気のみ）、'indefinite'（不定の狂気のみ）、'both'（両方）を指定できます
        - **重要**: characterIdには、必ず探索者情報に記載されているIDを正確に使用してください（例：キャラクター情報に「ID: char-001」とある場合は"char-001"を使用）
        一時的狂気は時間経過でも自動回復しますが、物語上の回復はより劇的で効果的です。
    *   **ダイスロール**: 物語を盛り上げるため、技能判定とは別に、単純なダイスロール（例: "1d6"）をプレイヤーに要求することができます。その際は理由も添えてください。
    *   **プッシュ・ロール**: プレイヤーは一度失敗した技能判定を「プッシュ」して再挑戦できます。これはプレイヤーが大きなリスクを負うことを意味します。プッシュ・ロールに失敗した場合、単なる失敗よりも悪い、深刻な結果（例：正気度の追加減少、怪我、状況の悪化、重要な手がかりの破壊など）を描写し、物語をよりドラマチックにしてください。プッシュ・ロールの判定結果が伝えられたら、その深刻な結果を必ず描写してください。
4.  **対話と誘導**: プレイヤーからの入力（行動宣言）に対して、自然で一貫性のある応答を返します。プレイヤーが次に何をすべきか迷わないように、具体的で魅力的な行動の選択肢を2～4個提示してください。プレイヤーは提示された選択肢以外にも自由に行動できます。プレイヤーからの入力には、どの探索者が行動しているかが示されている場合があります。
5.  **ゲームの結末**: 探索者たちがシナリオのクリア条件を満たした場合、\`gameClear\`を\`true\`に設定し、物語の結末を描写してください。その際、報酬として特別なアイテムや情報を与える場合は、\`rewards\`配列にその内容（名前と効果）を記述してください。探索者たちが失敗条件を満たした場合（例：全員が死亡・発狂）、\`gameOver\`を\`true\`に設定し、悲劇的な結末を描写してください。\`gameClear\`と\`gameOver\`は同時に\`true\`にはなりません。
6.  **出力**: あなたの応答は、常に指示されたJSON形式でなければなりません。

常に日本語で応答してください。プレイヤーを「探索者」または「探索者たち」と呼びかけ、不気味で謎めいた雰囲気を維持してください。ゲームの結末は、探索者たちの行動によって、生還、アーティファクトの発見、あるいは狂気や死に至るなど、多様なものにしてください。`;
